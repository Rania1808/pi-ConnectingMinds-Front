<!-- chat body container -->
<div class="chat-body">
    <!-- User details - sticky top -->
    <app-user-details class="app-user-details"></app-user-details>

    <!-- Chat messages - scrollable content -->
    <div class="chat-content px-4 py-4" #scrollMe>
        <ng-container *ngFor="let message of chatData?.messages; let i = index; trackBy: trackByMessageId">
            <!-- Messages from the current user -->
            <div *ngIf="message.userId === user?.userId; else otherUserMessage" class="d-flex justify-content-end align-items-start mb-4">
                <div class="message-content user-message">
                    <div class="dropdown dropstart">
                        <a class="text-link" href="#" role="button" id="dropdownMenuLinkTwo" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fe fe-more-vertical"></i>
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="#"><i class="fe fe-copy dropdown-item-icon"></i>Copy</a>
                            <a class="dropdown-item" href="#"><i class="fe fe-edit dropdown-item-icon"></i>Edit</a>
                            <a class="dropdown-item" href="#" (click)="$event.preventDefault(); deleteMessage(message)">
                                <i class="fe fe-trash dropdown-item-icon"></i>Delete
                              </a>
                        </div>
                    </div>
                    <div class="card bg-primary text-white" [ngClass]="{'deleted-message': message.deleted}">
                        <div class="card-body p-3">
                            <p class="mb-0">{{ message.deleted ? 'This message was deleted' : message.content }}</p>
                        </div>
                    </div>
                    <!-- Conditionally render the image only on the last message from the user -->
                    <ng-container *ngIf="isLastMessageFromUser(i, message.userId); else spacer">
                        <img [src]="user?.pic" alt="" class="rounded-circle avatar-md">
                    </ng-container>
                    <ng-template #spacer>
                        <div class="right-image-spacer"></div>
                    </ng-template>
                </div>
            </div>
            <!-- Messages from other users -->
            <ng-template #otherUserMessage>
                <div class="d-flex justify-content-start align-items-start mb-4">
                    <div class="message-content other-user-message">
                        <div class="dropdown dropend ms-2 mt-2">
                            <a class="text-link" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fe fe-more-vertical"></i>
                            </a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="#"><i class="fe fe-copy dropdown-item-icon"></i>Copy</a>
                                <a class="dropdown-item" href="#"><i class="fe fe-corner-up-left dropdown-item-icon"></i>Forward</a>
                                <a class="dropdown-item" href="#"><i class="fe fe-star dropdown-item-icon"></i>Favourite</a>
                                <a class="dropdown-item" href="#" (click)="$event.preventDefault(); deleteMessage(message)">
                                    <i class="fe fe-trash dropdown-item-icon"></i>Delete
                                  </a>
                            </div>
                        </div>
                        <div class="card" [ngClass]="{'deleted-message': message.deleted}">
                            <div class="card-body p-3">
                                <p class="mb-0 text-dark">{{ message.deleted ? 'This message was deleted' : message.content }}</p>
                            </div>
                        </div>
                        <!-- Conditional rendering for image on the left -->
                        <ng-container *ngIf="isLastMessageFromUser(i, message.userId); else otherSpacer">
                            <img [src]="otherUser?.pic" alt="Other User Avatar" class="rounded-circle avatar-md">
                        </ng-container>
                        <ng-template #otherSpacer>
                            <div class="left-image-spacer"></div>
                        </ng-template>
                    </div>
                </div>
            </ng-template>
        </ng-container>
    </div>

    <!-- Chat footer - sticky bottom -->
    <app-chat-footer class="app-chat-footer" [newMessage]="newMessage"></app-chat-footer>
</div>
